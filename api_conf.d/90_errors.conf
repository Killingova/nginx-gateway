# =========================================================
# 90_errors.conf (server-level snippet)
# Rolle:
# - Stable JSON error envelope via named locations
# =========================================================

location @gw_err_400 {
  internal;
  default_type application/json;
  return 400 '{"status":400,"error":{"code":"VALIDATION_FAILED","message":"Request validation failed."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_401 {
  internal;
  default_type application/json;
  return 401 '{"status":401,"error":{"code":"UNAUTHORIZED","message":"Authentication required or invalid."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_403 {
  internal;
  default_type application/json;
  return 403 '{"status":403,"error":{"code":"FORBIDDEN","message":"Access denied."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_404 {
  internal;
  default_type application/json;
  return 404 '{"status":404,"error":{"code":"NOT_FOUND","message":"Route not found."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_405 {
  internal;
  default_type application/json;
  return 405 '{"status":405,"error":{"code":"METHOD_NOT_ALLOWED","message":"Method not allowed."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_413 {
  internal;
  default_type application/json;
  return 413 '{"status":413,"error":{"code":"PAYLOAD_TOO_LARGE","message":"Payload too large."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_429 {
  internal;
  default_type application/json;
  return 429 '{"status":429,"error":{"code":"RATE_LIMITED","message":"Too many requests."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_500 {
  internal;
  default_type application/json;
  return 500 '{"status":500,"error":{"code":"INTERNAL","message":"Internal gateway error."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_502 {
  internal;
  default_type application/json;
  return 502 '{"status":502,"error":{"code":"BAD_GATEWAY","message":"Upstream unavailable."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_503 {
  internal;
  default_type application/json;
  return 503 '{"status":503,"error":{"code":"SERVICE_UNAVAILABLE","message":"Service unavailable."},"request_id":"$gateway_request_id"}\n';
}

location @gw_err_504 {
  internal;
  default_type application/json;
  return 504 '{"status":504,"error":{"code":"GATEWAY_TIMEOUT","message":"Upstream timeout."},"request_id":"$gateway_request_id"}\n';
}
